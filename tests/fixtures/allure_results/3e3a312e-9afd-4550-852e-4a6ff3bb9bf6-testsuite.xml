<?xml version="1.0" encoding="UTF-8"?>
<alr:test-suite xmlns:alr="urn:model.allure.qatools.yandex.ru" start="1591214277257" stop="1591214309406" version="1.4.0">
  <name>Tests\Support.integrationflow</name>
  <test-cases>
    <test-case start="1591214277260" stop="1591214309404" status="passed">
      <name>testImportOrderAndShipmentFlow with data set #0</name>
      <steps>
        <step start="1591214277295" stop="1591214278503" status="passed">
          <name>init fixtures ["Tests\\Support\\Fixture\\Auth\\AuthFixture","Tests\\Support\\Fixture\\AxaptaCategory\\SubCategoryCommonFixture"]</name>
        </step>
        <step start="1591214278503" stop="1591214278503" status="passed">
          <name>set headers {"Accept":"application/json"}</name>
        </step>
        <step start="1591214278503" stop="1591214278504" status="passed">
          <name>authenticate by token "ACCESS_TOKEN_MX_WS_1"</name>
        </step>
        <step start="1591214278505" stop="1591214278505" status="passed">
          <name>get expected response "bob","wsdl-ru","xml"</name>
        </step>
        <step start="1591214278505" stop="1591214278507" status="passed">
          <name>expect request to wire mock "WireMock\\Client\\MappingBuilder"</name>
        </step>
        <step start="1591214278507" stop="1591214278507" status="passed">
          <name>get expected response "bob","ready-for-shipment-success","xml"</name>
        </step>
        <step start="1591214278507" stop="1591214278509" status="passed">
          <name>expect request to wire mock "WireMock\\Client\\MappingBuilder"</name>
        </step>
        <step start="1591214278509" stop="1591214278509" status="passed">
          <name>get expected response "bob","create-confirmed-order-success","xml"</name>
        </step>
        <step start="1591214278509" stop="1591214278510" status="passed">
          <name>expect request to wire mock "WireMock\\Client\\MappingBuilder"</name>
        </step>
        <step start="1591214278511" stop="1591214278511" status="passed">
          <name>get file route "orders"</name>
        </step>
        <step start="1591214278511" stop="1591214278975" status="passed">
          <name>send post "/api/v1/import/orders",[],{"file":{"name":"orders•xlsx","tmp_name":"/data/tests/_data/_import/orders•xlsx","size":19004,"type":"application/vnd•openxmlformats-officedocument•spreadsheetml•sheet",•••}</name>
        </step>
        <step start="1591214278975" stop="1591214278975" status="passed">
          <name>see response code is 201</name>
        </step>
        <step start="1591214278976" stop="1591214278976" status="passed">
          <name>get orders route "MXTEST-1234567"</name>
        </step>
        <step start="1591214278976" stop="1591214279024" status="passed">
          <name>send get "/api/v1/orders/MXTEST-1234567"</name>
        </step>
        <step start="1591214279024" stop="1591214279024" status="passed">
          <name>see response code is 200</name>
        </step>
        <step start="1591214279024" stop="1591214279026" status="passed">
          <name>grab state id "new"</name>
        </step>
        <step start="1591214279027" stop="1591214279028" status="passed">
          <name>check order in status "MXTEST-1234567",1</name>
        </step>
        <step start="1591214279029" stop="1591214279029" status="passed">
          <name>get file route "shipments"</name>
        </step>
        <step start="1591214279029" stop="1591214279255" status="passed">
          <name>send post "/api/v1/import/shipments",[],{"file":{"name":"shipment_flow•xlsx","tmp_name":"/data/tests/_data/_import/shipment_flow•xlsx","size":15662,"type":"application/vnd•openxmlformats-officedocument•spre•••}</name>
        </step>
        <step start="1591214279255" stop="1591214279255" status="passed">
          <name>see response code is 201</name>
        </step>
        <step start="1591214279255" stop="1591214279257" status="passed">
          <name>see num records 1,"system_exchange_status",{"status":"need_to_sync","exchange":"shipment_item","system":"dms"}</name>
        </step>
        <step start="1591214279257" stop="1591214279258" status="passed">
          <name>i am going to run generate sku process </name>
        </step>
        <step start="1591214279258" stop="1591214280566" status="passed">
          <name>run queue consumer shell command "job_enrich_products"</name>
        </step>
        <step start="1591214280566" stop="1591214280567" status="passed">
          <name>i am going to run wms ip exchange process </name>
        </step>
        <step start="1591214280567" stop="1591214281759" status="passed">
          <name>run queue consumer shell command "exchange_wms"</name>
        </step>
        <step start="1591214281759" stop="1591214281759" status="passed">
          <name>i am going to run create sku process </name>
        </step>
        <step start="1591214281759" stop="1591214283057" status="passed">
          <name>run queue consumer shell command "exchange_axapta"</name>
        </step>
        <step start="1591214283057" stop="1591214283059" status="passed">
          <name>see item in status "MXSKU1234567","New to be confirmed","item"</name>
        </step>
        <step start="1591214283059" stop="1591214283060" status="passed">
          <name>i am going to run queues commands to prepare order confirmation </name>
        </step>
        <step start="1591214283060" stop="1591214284529" status="passed">
          <name>run queue consumer shell command "job_validate_address"</name>
        </step>
        <step start="1591214284529" stop="1591214284529" status="passed">
          <name>authenticate as "MX"</name>
        </step>
        <step start="1591214284529" stop="1591214284529" status="passed">
          <name>get orders shipping address route "MXTEST-1234567"</name>
        </step>
        <step start="1591214284530" stop="1591214284775" status="passed">
          <name>send post "/api/v1/orders/MXTEST-1234567/shipping_address",{"street":"ул Домодедовская","city":"Санкт-Петербург","cityId":"7800000000000","houseNum":"д•10 стр•А","streetId":"78000000000188000","zipcode":"19•••}</name>
        </step>
        <step start="1591214284776" stop="1591214284776" status="passed">
          <name>see response code is 201</name>
        </step>
        <step start="1591214284776" stop="1591214284776" status="passed">
          <name>get orders customer route "MXTEST-1234567"</name>
        </step>
        <step start="1591214284776" stop="1591214284815" status="passed">
          <name>send post "/api/v1/orders/MXTEST-1234567/customer",{"firstName":"Иван","lastName":"Иванов","middleName":"Иванович","phone":"+71234567890","email":"emailrw@lamoda•ru"}</name>
        </step>
        <step start="1591214284815" stop="1591214284816" status="passed">
          <name>see response code is 201</name>
        </step>
        <step start="1591214284816" stop="1591214284816" status="passed">
          <name>route to order delivery method "MXTEST-1234567"</name>
        </step>
        <step start="1591214284816" stop="1591214284945" status="passed">
          <name>send post "/api/v1/orders/MXTEST-1234567/delivery_method",{"deliveryDate":"2015-07-21","deliveryIntervalFrom":"10:20","deliveryIntervalTo":"18:00","deliveryIntervalId":270238,"shippingMethodName":"Lamoda Ex•••}</name>
        </step>
        <step start="1591214284945" stop="1591214284945" status="passed">
          <name>see response code is 201</name>
        </step>
        <step start="1591214284946" stop="1591214284947" status="passed">
          <name>grab from database "shipment","id",{"code":"MX-1111"}</name>
        </step>
        <step start="1591214284947" stop="1591214284947" status="passed">
          <name>i am going to confirm order </name>
        </step>
        <step start="1591214284947" stop="1591214284947" status="passed">
          <name>authenticate as "MX"</name>
        </step>
        <step start="1591214284948" stop="1591214284948" status="passed">
          <name>get orders event route "MXTEST-1234567"</name>
        </step>
        <step start="1591214284948" stop="1591214285097" status="passed">
          <name>send post "/api/v1/orders/MXTEST-1234567/events",{"type":"confirm"}</name>
        </step>
        <step start="1591214285098" stop="1591214285098" status="passed">
          <name>see response code is 201</name>
        </step>
        <step start="1591214285098" stop="1591214285098" status="passed">
          <name>i am going to run queues commands to prepare ready for shipment </name>
        </step>
        <step start="1591214285098" stop="1591214290953" status="passed">
          <name>run queue consumer shell command "job_common"</name>
        </step>
        <step start="1591214290953" stop="1591214292327" status="passed">
          <name>run queue consumer shell command "exchange_bob_create_confirmed_order"</name>
        </step>
        <step start="1591214292327" stop="1591214292327" status="passed">
          <name>i am going to call update order status exchange with opm </name>
        </step>
        <step start="1591214292327" stop="1591214292327" status="passed">
          <name>authenticate as "OPM"</name>
        </step>
        <step start="1591214292328" stop="1591214292482" status="passed">
          <name>send soap request "UpdateOrderStatus","DOMDocument"</name>
        </step>
        <step start="1591214292482" stop="1591214292483" status="passed">
          <name>i am going to run data matrix assign process </name>
        </step>
        <step start="1591214292483" stop="1591214293749" status="passed">
          <name>run queue consumer shell command "exchange_event_bus"</name>
        </step>
        <step start="1591214293749" stop="1591214295166" status="passed">
          <name>run queue consumer shell command "exchange_bob"</name>
        </step>
        <step start="1591214295166" stop="1591214295168" status="passed">
          <name>see item in status "MXSKU1234567","Confirmed","item"</name>
        </step>
        <step start="1591214295168" stop="1591214295168" status="passed">
          <name>i am going to call update order status exchange with opm </name>
        </step>
        <step start="1591214295168" stop="1591214295168" status="passed">
          <name>authenticate as "OPM"</name>
        </step>
        <step start="1591214295169" stop="1591214295223" status="passed">
          <name>send soap request "UpdateOrderStatus","DOMDocument"</name>
        </step>
        <step start="1591214295223" stop="1591214295223" status="passed">
          <name>i am going to run data matrix assign process </name>
        </step>
        <step start="1591214295223" stop="1591214301093" status="passed">
          <name>run queue consumer shell command "exchange_event_bus"</name>
        </step>
        <step start="1591214301094" stop="1591214301094" status="passed">
          <name>i am going to run dms product type create process </name>
        </step>
        <step start="1591214301094" stop="1591214302270" status="passed">
          <name>run queue consumer shell command "exchange_dms_product_type_create"</name>
        </step>
        <step start="1591214302271" stop="1591214308120" status="passed">
          <name>run queue consumer shell command "job_common"</name>
        </step>
        <step start="1591214308121" stop="1591214309378" status="passed">
          <name>run queue consumer shell command "exchange_axapta"</name>
        </step>
        <step start="1591214309379" stop="1591214309379" status="passed">
          <name>get order id "MXTEST-1234567"</name>
        </step>
        <step start="1591214309380" stop="1591214309382" status="passed">
          <name>see process in state "ValidateAddress","ok","order",1</name>
        </step>
        <step start="1591214309382" stop="1591214309383" status="passed">
          <name>see process in state "GetDeliveryMethod","ok","order",1</name>
        </step>
        <step start="1591214309383" stop="1591214309385" status="passed">
          <name>see process in state "DeliveryReserveCapacity","ok","order",1</name>
        </step>
        <step start="1591214309385" stop="1591214309386" status="passed">
          <name>see process in state "CreateConfirmedOrder","ok","order",1</name>
        </step>
        <step start="1591214309386" stop="1591214309387" status="passed">
          <name>see process in state "ReadyForShipment","ok","order",1</name>
        </step>
        <step start="1591214309388" stop="1591214309389" status="passed">
          <name>see process in state "GenerateSku","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309389" stop="1591214309390" status="passed">
          <name>see process in state "AxaptaShipmentCreateSku","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309390" stop="1591214309392" status="passed">
          <name>see process in state "DataMatrixAssign","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309392" stop="1591214309393" status="passed">
          <name>see process in state "DMSProductTypeCreate","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309393" stop="1591214309394" status="passed">
          <name>see process in state "WMSImportInProduct","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309395" stop="1591214309396" status="passed">
          <name>see process in state "AdviceToWMS","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309396" stop="1591214309397" status="passed">
          <name>see process in state "AxaptaGoodsOut","ok","shipmentIn",1</name>
        </step>
        <step start="1591214309397" stop="1591214309398" status="passed">
          <name>see num records 1,"system_exchange_status",{"status":"sent","exchange":"shipment_item","system":"dms"}</name>
        </step>
        <step start="1591214309398" stop="1591214309398" status="passed">
          <name>i am going to check order and item statuses </name>
        </step>
        <step start="1591214309399" stop="1591214309399" status="passed">
          <name>grab state id "inDelivery"</name>
        </step>
        <step start="1591214309399" stop="1591214309400" status="passed">
          <name>check order in status "MXTEST-1234567",7</name>
        </step>
        <step start="1591214309400" stop="1591214309401" status="passed">
          <name>assert order represent status "MXTEST-1234567","confirmed"</name>
        </step>
        <step start="1591214309401" stop="1591214309402" status="passed">
          <name>see item in status "MXSKU1234567","Ready for shipment"</name>
        </step>
      </steps>
      <labels>
        <label name="feature" value="Create order"/>
        <label name="story" value="Import order file flow"/>
      </labels>
      <parameters>
        <parameter name="orderFile" value="{&quot;file&quot;:{&quot;name&quot;:&quot;orders.xlsx&quot;,&quot;tmp_name&quot;:&quot;/data/tests/_data/_import/orders.xlsx&quot;,&quot;size&quot;:19004,&quot;type&quot;:&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,&quot;error&quot;:0}}" kind="argument"/>
        <parameter name="shipmentFile" value="{&quot;file&quot;:{&quot;name&quot;:&quot;shipment_flow.xlsx&quot;,&quot;tmp_name&quot;:&quot;/data/tests/_data/_import/shipment_flow.xlsx&quot;,&quot;size&quot;:15662,&quot;type&quot;:&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,&quot;error&quot;:0}}" kind="argument"/>
        <parameter name="orderNr" value="&quot;MXTEST-1234567&quot;" kind="argument"/>
        <parameter name="eventConfirm" value="{&quot;type&quot;:&quot;confirm&quot;}" kind="argument"/>
        <parameter name="sku" value="&quot;SKU1234567&quot;" kind="argument"/>
        <parameter name="shipmentNr" value="&quot;MX-1111&quot;" kind="argument"/>
      </parameters>
    </test-case>
  </test-cases>
</alr:test-suite>
